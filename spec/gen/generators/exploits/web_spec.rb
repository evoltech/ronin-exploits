require 'spec_helper'
require 'ronin/gen/generators/exploits/web'
require 'ronin/exploits/web'

require 'gen/generators/exploits/exploit_examples'
require 'tmpdir'
require 'fileutils'

describe Gen::Generators::Exploits::Web do
  before(:all) do
    @path = File.join(Dir.tmpdir,'generated_exploit.rb')

    Gen::Generators::Exploits::Web.generate(
      {
        :helpers => %w[buffer_overflow],
        :leverages => %w[shell],
        :exploits => %w[file_read file_write],
        :url_path => '/some/path',
        :url_query => 'var=1'
      },
      [@path]
    )

    @exploit = Exploits::Web.load_context(@path)
  end

  it_should_behave_like "an Exploit"

  it "should define a Web exploit" do
    @exploit.class.should == Exploits::Web
  end

  it "should define helpers to load" do
    @exploit.should be_kind_of(Exploits::Helpers::BufferOverflow)
  end

  it "should set the url_path property" do
    @exploit.url_path.should == '/some/path'
  end

  it "should set the url_query property" do
    @exploit.url_query.should == 'var=1'
  end

  after(:all) do
    FileUtils.rm(@path)
  end
end
