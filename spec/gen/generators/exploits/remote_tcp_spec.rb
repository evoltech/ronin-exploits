require 'spec_helper'
require 'ronin/gen/generators/exploits/remote_tcp'
require 'ronin/exploits/remote_tcp'

require 'gen/generators/exploits/exploit_examples'
require 'tmpdir'
require 'fileutils'

describe Gen::Generators::Exploits::RemoteTCP do
  before(:all) do
    @path = File.join(Dir.tmpdir,'generated_remote_tcp_exploit.rb')

    described_class.generate(
      {
        :helpers => %w[buffer_overflow],
        :leverages => %w[shell],
        :exploits => %w[file_read file_write],
        :default_port => 22
      },
      [@path]
    )
  end

  subject { Exploits::RemoteTCP.load_object(@path) }

  it_should_behave_like "a generated Exploit"

  it "should define a RemoteTCP exploit" do
    subject.class.should == Exploits::RemoteTCP
  end

  it "should define helpers to load" do
    subject.should be_kind_of(Exploits::Helpers::BufferOverflow)
  end

  it "should set the default_port property" do
    subject.default_port.should == 22
  end

  after(:all) { FileUtils.rm(@path) }
end
