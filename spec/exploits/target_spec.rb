require 'ronin/exploits/target'

require 'spec_helper'

describe Exploits::Target do
  before(:each) do
    @target = Exploits::Target.new(
      :data => {:var => 1, :test => 'hello'}
    )
  end

  it "should contain target data" do
    @target.data[:var].should == 1
    @target.data[:test].should == 'hello'
  end

  it "should provide Hash like access to target data" do
    @target[:var].should == 1
    @target[:test].should == 'hello'
  end

  it "should be able to set data like a Hash" do
    @target[:var] = 2

    @target[:var].should == 2
  end

  it "should provide OStruct like access to target data" do
    @target.var.should == 1
    @target.test.should == 'hello'
  end

  it "should be able to set data like an OStruct" do
    @target.var = 2

    @target.var.should == 2
  end

  it "should be able to serialize and deserialize it's target data" do
    @target.save!

    target = Exploits::Target.first
    target.data[:var].should == 1
    target.data[:test].should == 'hello'
  end

  it "should not raise TargetDataMissing when setting new data" do
    lambda {
      @target.bla = 'yes'
    }.should_not raise_error(Exploits::TargetDataMissing)

    @target.bla.should == 'yes'
  end

  it "should raise TargetDataMissing when accessing non-existant data" do
    lambda {
      @target.bla
    }.should raise_error(Exploits::TargetDataMissing)
  end
end
