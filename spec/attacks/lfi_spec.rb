require 'spec_helper'
require 'ronin/attacks/lfi'

describe Attacks::LFI do
  let(:query_param)   { 'q' }
  let(:original_data) { 'foo' }
  let(:traversal)     { 4 }

  let(:uri) { URI("http://www.example.com/page.php?#{query_param}=#{original_data}") }
  let(:url) { URL.from(uri) }

  let(:attack) do
    described_class.new(
      :url           => url,
      :query_param   => query_param,
      :original_data => original_data,
      :traversal     => traversal,
      :terminate     => true
    )
  end
  subject { attack }

  describe "#inject" do
    let(:path) { '/etc/passwd' }

    subject { attack.inject(path) }

    it "should traverse up n directories" do
      subject.should include(('../' * traversal) + path)
    end

    it "should support terminating the path with a %0 character" do
      subject.should be_end_with("#{path}%0")
    end
  end
end
