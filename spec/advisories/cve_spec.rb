require 'spec_helper'
require 'ronin/advisories/cve'

describe Advisories::CVE do
  let(:year) { 2011 }
  let(:advisory) { described_class.new(:number => "#{year}-1234") }

  subject { advisory }

  it "should default 'publisher' to CVE" do
    subject.publisher.should == 'CVE'
  end

  it "should extract the year from the 'number'" do
    subject.year.should == year
  end

  describe "#url" do
    subject { advisory.url }

    its(:scheme) { should == 'https' }
    its(:host)   { should == 'web.nvd.nist.gov' }
    its(:path)   { should == '/view/vuln/detail' }

    it "should set 'vulnId' to the CVE number" do
      subject.query.should == "vulnId=#{advisory.number}"
    end
  end
end
