#
#--
# Ronin Exploits - A Ruby library for Ronin that provides exploitation and
# payload crafting functionality.
#
# Copyright (c) 2007-2009 Hal Brodigan (postmodern.mod3 at gmail.com)
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
#++
#

require 'ronin/targeted_os'

module Ronin
  module TargetsOS
    def self.included(base)
      base.module_eval do
        # The payloads targeted OS
        belongs_to :os,
                   :child_key => [:os_id],
                   :class_name => 'Ronin::TargetedOS'


        #
        # Returns the current targeted OS if no _arguments_ are given. If
        # _arguments_ are given, a new TargetedOS object will be created
        # from the given _arguments_ and associated with the target.
        #
        #   target.os
        #   # => nil
        #
        #   target.os(:name => 'FreeBSD', :version => '7.1')
        #   # => #<Ronin::TargetedOS type=Ronin::TargetedOS id=nil
        #   # name="FreeBSD" version="7.1">
        #
        def os(*arguments)
          unless arguments.empty?
            return self.os = TargetedOS.first_or_create(*arguments)
          else
            return os_association
          end
        end
      end
    end
  end
end
